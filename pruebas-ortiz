import * as XLSX from 'xlsx';
import { Request, Response } from 'express';
import multer from 'multer';
import path from 'path';
import fs from 'fs';

const upload = multer({ dest: 'uploads/' });

app.post('/api/importar-excel', upload.single('archivo'), (req: Request, res: Response) => {
  const archivo = req.file;

  if (!archivo) return res.status(400).send('No se subió ningún archivo.');

  const workbook = XLSX.readFile(archivo.path);
  const hoja = workbook.Sheets[workbook.SheetNames[0]];

  const data = XLSX.utils.sheet_to_json(hoja);
  console.log('Datos del Excel:', data);

  // Aquí puedes guardar los datos en la base de datos con tus modelos

  // Limpieza del archivo temporal
  fs.unlinkSync(archivo.path);

  res.status(200).json({ mensaje: 'Archivo importado correctamente', datos: data });
});
